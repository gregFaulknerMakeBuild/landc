"use strict";(()=>{var u=(l,t=document)=>{let e=t.querySelectorAll(l);return e.length?[...e]:[]};var r=(l,t=document)=>t.querySelector(l)??void 0;var d={residentialborrowinglimit:{inputNames:["Applicant1Income","Applicant2Income"],outputNames:["BorrowingAmountLower","BorrowingAmountHigher"]},buytoletborrowinglimit:{inputNames:["RentalIncome"],outputNames:["BorrowingAmountLower","BorrowingAmountHigher"]},mortgagecost:{inputNames:["RepaymentValue","TermYears","Rate","PaymentType"],outputNames:["MonthlyPayment","TotalOverTerm","CapitalRepayment","InterestRepayment","ChartLabels","ChartDate"]},houseprice:{inputNames:["Number","SubBuildingName","BuildingName","DependentStreet","Street","Postcode"],outputNames:["PropertyValue","ValuationUpper","ValuationLower","MonthlyRental","MonthlyRentalUpper","MonthlyRentalLower"]},loantovalue:{inputNames:["PropertyValue","Type","DepositAmount","LoanAmount","LoanToValue"],outputNames:["LoanAmount","DepositAmount","LoanToValue"]},stampduty:{inputNames:["PurchasePrice","Location","FirstTimeBuyer","SecondProperty"],outputNames:["BandRate","BandValue","BandCost","TotalCost"],outputRepeats:["StampDutyData"]}};var c="data-calc",b="https://landc-website.azurewebsites.net/api/calculatorhttptrigger",m=class{constructor(t){this.name=t,this.component=r(`[${c}="${this.name}"]`),this.inputs=u(`[${c}-input]`,this.component),this.outputs=u(`[${c}-output]`,this.component),this.outputRepeatTemplates=u(`[${c}-output-repeat]`,this.component),this.outputRepeats={},this.results=r(`[${c}-el="results"]`,this.component),this.button=r(`[${c}-el="button"]`,this.component),this.buttonText=r(`[${c}-el="button-text"]`,this.button),this.buttonLoader=r(`[${c}-el="button-loader"]`,this.button),this.isLoading=!1}init(){console.groupCollapsed(this.name),console.log(this),this.checkInputs(!0),this.checkOutputs(!0),console.groupEnd(),this.bindInputEvents()}checkInputs(t){let e=d[this.name];if(!e)return console.error(`${this.name}: configuration not found.`),!1;let n=[],o=!0;return e.inputNames.forEach(s=>{let a=this.inputs.find(i=>i.dataset.calcInput===s);n.push({input:s,present:!!a}),a||(o=!1)}),t&&(console.groupCollapsed(`${o?"all inputs present":"inputs missing"}`),console.table(n),console.groupEnd()),o}checkOutputs(t){let e=d[this.name];if(!e)return console.error(`${this.name}: configuration not found.`),!1;let n=[],o=!0;return e.outputNames.forEach(s=>{let a=this.outputs.find(i=>i.dataset.calcOutput===s);n.push({output:s,present:!!a}),a||(o=!1)}),t&&(console.groupCollapsed(`${o?"all outputs present":"outputs missing"}`),console.table(n),console.groupEnd()),o}toggleLoading(t){this.isLoading=!this.isLoading,this.isLoading?(this.buttonText.style.opacity="0",this.buttonLoader.style.opacity="1"):t?(this.buttonText.textContent="Recalculate",this.buttonText.style.opacity="1",this.buttonLoader.style.opacity="0"):(this.buttonText.textContent="Try again...",this.buttonText.style.opacity="1",this.buttonLoader.style.opacity="0")}getInputWrapper(t){let e=t,n;for(;e;)if(e.parentElement&&e.parentElement.classList&&e.parentElement.classList.contains("calculator-field_component")){n=e.parentElement;break}else if(e.parentElement)e=e.parentElement;else break;return n}setInputMessage(t,e){let n=this.getInputWrapper(t);if(!n)return;let o=r(".calculator-field_message",n);if(!o)return;let{originalMessage:s}=o.dataset;!s&&o.textContent&&(o.dataset.originalMessage=o.textContent),e?o.textContent=e:o.dataset.originalMessage&&(o.textContent=o.dataset.originalMessage)}validateInput(t){let e=!0,n;if(t instanceof HTMLInputElement){let{type:o}=t;switch(o){case"text":e=t.checkValidity(),n=t.validationMessage;case"number":let{min:s,max:a,value:i}=t;if(e=Number(i)>=Number(s)&&Number(i)<=Number(a),e)break;Number(i)<Number(s)?n=`Input needs to be greater than ${s}`:Number(i)>Number(a)&&(n=`Input needs to be smaller than ${a}`)}}else t instanceof HTMLSelectElement&&(e=t.checkValidity(),n=t.validationMessage);return n?this.setInputMessage(t,n):this.setInputMessage(t),e}validateInputs(){return this.inputs.every(t=>this.validateInput(t))}getInputValue(t){if(t instanceof HTMLInputElement||t instanceof HTMLSelectElement)return t.value}getInputValues(){let t={};return this.inputs.forEach(e=>{let{calcInput:n}=e.dataset,o=this.getInputValue(e);!n||!o||(t[n]=o)}),t}bindInputEvents(){this.inputs.forEach(t=>{t.addEventListener("change",()=>{this.validateInput(t)})}),this.button.addEventListener("click",()=>{this.toggleLoading();let t=this.validateInputs(),e=this.checkInputs();if(!t||!e){this.toggleLoading(!1);return}this.handleAzureRequest()})}async handleAzureRequest(){try{console.groupCollapsed("API Call"),console.time("API Request");let t=await this.makeAzureRequest();this.result=t.result,console.timeEnd("API Request"),console.log(t),console.groupEnd(),this.toggleLoading(!0),this.displayResults()}catch(t){console.error("Error retrieving calculation",t),this.toggleLoading(!1)}}async makeAzureRequest(){let t=new Headers;t.append("Content-Type","application/json");let e=JSON.stringify({calculator:this.name,input:this.getInputValues()}),n=await fetch(b,{method:"POST",headers:t,body:e});if(!n.ok)throw new Error(`API responded with status ${n.status}`);return n.json()}displayResults(){!this.result||this.result===void 0||(this.outputRepeatTemplates.forEach(t=>{t.style.display="none";let e=t.dataset.calcOutputRepeat;if(!e)return;let n=this.outputRepeats[e];n&&n.forEach(i=>{i.remove()});let o=this.result[e],s=[],{parentElement:a}=t;a||console.error(`No parent element for ${e} elements`),o.forEach(i=>{let p=t.cloneNode(!0);u(`[${c}-output]`,p).forEach(h=>{let{calcOutput:g}=h.dataset;g&&(h.textContent=i[g])}),p.style.removeProperty("display"),a.appendChild(p),s.push(p)}),this.outputRepeats[e]=s}),this.outputs.forEach(t=>{let{calcOutput:e}=t.dataset;if(!e)return;let n=this.result[e];(n===0||n)&&(t.textContent=n.toString())}),this.results.style.display="block")}};var f=()=>{console.log("calculators"),u("[data-calc]").forEach(e=>{let{calc:n}=e.dataset;if(!n)return;new m(n).init()})};var E=()=>{console.log("dialogs");let l="data-dialog";u(`[${l}="component"]`).forEach(e=>{let n=r(`[${l}="open"]`,e),o=r("dialog",e),s=r(`[${l}="close"]`,e);!n||!o||!s||(n.addEventListener("click",()=>{o.showModal()}),s.addEventListener("click",()=>{o.close()}))})};var y=()=>{console.log("components"),E()};window.Webflow||(window.Webflow=[]);window.Webflow.push(()=>{y(),f()});})();
